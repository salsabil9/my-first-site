<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المنزل الآمن: تشافي صدمات الطفولة</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            /* Light Mode Colors */
            --light-bg: #F0F2F5; /* فاتح رمادي مزرق */
            --light-text-color: #333;
            --light-primary-color: #4CAF50; /* أخضر */
            --light-secondary-color: #2196F3; /* أزرق */
            --light-accent-color: #FFC107; /* أصفر */
            --light-card-bg: #FFFFFF;
            --light-border-color: #E0E0E0;
            --light-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);

            /* Dark Mode Colors (initialized as light mode for default) */
            --dark-bg: #1A202C;
            --dark-text-color: #E2E8F0;
            --dark-primary-color: #689F38; /* أخضر داكن */
            --dark-secondary-color: #1976D2; /* أزرق داكن */
            --dark-accent-color: #FFB300; /* أصفر داكن */
            --dark-card-bg: #2D3748;
            --dark-border-color: #4A5568;
            --dark-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);

            /* Current active colors (default to light) */
            --current-bg: var(--light-bg);
            --current-text-color: var(--light-text-color);
            --current-primary-color: var(--light-primary-color);
            --current-secondary-color: var(--light-secondary-color);
            --current-accent-color: var(--light-accent-color);
            --current-card-bg: var(--light-card-bg);
            --current-border-color: var(--light-border-color);
            --current-shadow: var(--light-shadow);

            /* Fonts */
            --heading-font: 'Amiri', serif;
            --body-font: 'Cairo', sans-serif;
        }

        body {
            font-family: var(--body-font);
            margin: 0;
            padding: 0;
            background-color: var(--current-bg);
            color: var(--current-text-color);
            line-height: 1.6;
            direction: rtl;
            text-align: right;
            transition: background-color 0.5s ease, color 0.5s ease;
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
        }

        /* Sidebar Navigation - Canva Style */
        .sidebar {
            width: 250px;
            background-color: var(--current-card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--current-shadow);
            flex-shrink: 0; /* Prevent shrinking */
            position: sticky; /* Sticky sidebar */
            top: 20px; /* Position from top */
            height: fit-content; /* Fit content height */
            z-index: 1000; /* Ensure it's above other content */
        }

        .sidebar h2 {
            font-family: var(--heading-font);
            color: var(--current-primary-color);
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.8em;
            border-bottom: 2px solid var(--current-primary-color);
            padding-bottom: 10px;
        }

        .sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar ul li {
            margin-bottom: 10px;
        }

        .sidebar ul li a {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: var(--current-text-color);
            text-decoration: none;
            font-weight: bold;
            border-radius: 8px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .sidebar ul li a i {
            margin-left: 10px; /* Space for icon */
            font-size: 1.2em;
        }

        .sidebar ul li a:hover,
        .sidebar ul li a.active {
            background-color: var(--current-secondary-color);
            color: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* Main Content Area */
        .main-content {
            flex-grow: 1; /* Allows it to take remaining space */
            min-width: 700px; /* Minimum width for content */
        }

        header {
            background-color: var(--current-primary-color);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: var(--current-shadow);
            border-radius: 12px;
            margin-bottom: 20px;
        }

        header h1 {
            margin: 0;
            font-size: 2.5em;
            font-family: var(--heading-font);
        }

        section {
            background-color: var(--current-card-bg);
            padding: 40px;
            margin-bottom: 20px;
            border-radius: 12px;
            box-shadow: var(--current-shadow);
            display: none; /* Hidden by default, shown by JS */
        }

        section.active {
            display: block; /* Show active section */
        }

        h2 {
            font-family: var(--heading-font);
            color: var(--current-primary-color);
            font-size: 2em;
            border-bottom: 2px solid var(--current-primary-color);
            padding-bottom: 10px;
            margin-bottom: 30px;
            text-align: right;
        }

        h3 {
            font-family: var(--heading-font);
            color: var(--current-secondary-color);
            font-size: 1.5em;
            margin-top: 30px;
            margin-bottom: 15px;
            text-align: right;
        }

        p {
            font-size: 1.1em;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        /* Buttons */
        .btn {
            display: inline-block;
            background-color: var(--current-accent-color);
            color: var(--current-text-color);
            padding: 12px 25px;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
            border: none;
            cursor: pointer;
            font-size: 1em;
        }

        .btn:hover {
            background-color: var(--current-primary-color);
            color: white;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--current-secondary-color);
            color: white;
        }
        .btn-secondary:hover {
            background-color: var(--current-primary-color);
        }


        /* Quiz Section */
        .quiz-question {
            background-color: var(--current-border-color);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .quiz-question p {
            font-weight: bold;
            margin-bottom: 10px;
        }
        .quiz-question label {
            display: block;
            margin-bottom: 8px;
            cursor: pointer;
            padding: 8px;
            background-color: var(--current-card-bg);
            border-radius: 5px;
            transition: background-color 0.2s ease;
        }
        .quiz-question label:hover {
            background-color: var(--light-bg); /* Use light background for hover to show difference */
        }
        body.dark-mode .quiz-question label:hover {
            background-color: var(--dark-bg);
        }

        /* Tasks Section */
        .tasks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .task-card {
            background-color: var(--current-border-color);
            padding: 25px;
            border-radius: 10px;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.1);
        }
        .task-card h4 {
            color: var(--current-secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        .task-card p {
            margin-bottom: 15px;
            font-size: 1em;
        }
        .task-card .task-completion {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 20px;
        }
        .task-card .task-completion input[type="checkbox"] {
            transform: scale(1.5);
            margin-left: 10px; /* Space for checkbox */
            cursor: pointer;
        }
        .task-card.completed {
            opacity: 0.7;
            background-color: var(--current-primary-color);
            color: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }
        .task-card.completed h4 {
            color: white;
        }

        /* Score & Progress */
        .progress-container {
            background-color: var(--current-border-color);
            padding: 25px;
            border-radius: 10px;
            margin-top: 20px;
        }
        .progress-bar-wrapper {
            width: 100%;
            background-color: var(--light-bg); /* Fixed light background for progress bar */
            border-radius: 15px;
            overflow: hidden;
            height: 30px;
            margin-top: 15px;
            border: 1px solid var(--current-border-color);
        }
        body.dark-mode .progress-bar-wrapper {
            background-color: #333; /* Darker background for progress bar in dark mode */
        }
        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--current-primary-color);
            border-radius: 15px;
            text-align: center;
            color: white;
            line-height: 30px;
            transition: width 0.5s ease-in-out;
            font-weight: bold;
        }
        .score-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }

        /* Journal/Notebook */
        .notebook-container {
            margin-top: 20px;
        }
        #journalEntry {
            width: 100%;
            min-height: 300px;
            padding: 15px;
            border: 1px solid var(--current-border-color);
            border-radius: 8px;
            font-family: var(--body-font);
            font-size: 1.1em;
            background-color: var(--current-card-bg);
            color: var(--current-text-color);
            resize: vertical;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.05);
        }
        #saveJournalBtn {
            margin-top: 15px;
        }

        /* Day/Night Mode Toggle */
        .mode-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 30px;
            background-color: var(--current-border-color);
            padding: 10px;
            border-radius: 50px;
            box-shadow: var(--current-shadow);
        }
        .mode-toggle button {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: var(--current-text-color);
            padding: 8px 15px;
            border-radius: 50px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .mode-toggle button:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }
        .mode-toggle button.active {
            background-color: var(--current-secondary-color);
            color: white;
        }

        /* Audio Controls */
        .audio-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--current-border-color);
        }
        .audio-controls button {
            background-color: var(--current-secondary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.3s ease;
        }
        .audio-controls button:hover {
            background-color: var(--current-primary-color);
        }
        .audio-controls button.active {
            background-color: var(--current-primary-color);
        }


        /* Dark Mode Styles */
        body.dark-mode {
            --current-bg: var(--dark-bg);
            --current-text-color: var(--dark-text-color);
            --current-primary-color: var(--dark-primary-color);
            --current-secondary-color: var(--dark-secondary-color);
            --current-accent-color: var(--dark-accent-color);
            --current-card-bg: var(--dark-card-bg);
            --current-border-color: var(--dark-border-color);
            --current-shadow: var(--dark-shadow);
        }

        /* Responsive Adjustments */
        @media (max-width: 992px) {
            .container {
                flex-direction: column;
                align-items: center;
            }
            .sidebar {
                width: 90%;
                position: static; /* Remove sticky on small screens */
                margin-bottom: 20px;
            }
            .main-content {
                min-width: unset; /* Remove min-width */
                width: 100%;
            }
            section {
                padding: 20px;
            }
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }
            h2 {
                font-size: 1.6em;
            }
            h3 {
                font-size: 1.3em;
            }
            .btn {
                padding: 10px 20px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>

    <audio id="windSound" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
        متصفحك لا يدعم عنصر الصوت.
    </audio>
    <audio id="nightSound" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" type="audio/mpeg">
        متصفحك لا يدعم عنصر الصوت.
    </audio>

    <div class="container">
        <aside class="sidebar">
            <h2><i class="fas fa-home"></i> المنزل الآمن</h2>
            <nav>
                <ul>
                    <li><a href="#welcome" class="nav-link active"><i class="fas fa-hand-sparkles"></i> مرحبًا بك</a></li>
                    <li><a href="#quiz" class="nav-link"><i class="fas fa-question-circle"></i> ابدأ الاختبار</a></li>
                    <li><a href="#tasks" class="nav-link"><i class="fas fa-clipboard-check"></i> مهام التشافي</a></li>
                    <li><a href="#progress" class="nav-link"><i class="fas fa-chart-line"></i> تتبع التقدم</a></li>
                    <li><a href="#journal" class="nav-link"><i class="fas fa-book"></i> مذكرة التدوين</a></li>
                    <li><a href="#resources" class="nav-link"><i class="fas fa-hand-holding-heart"></i> مصادر الدعم</a></li>
                </ul>
            </nav>
            <div class="mode-toggle">
                <button id="dayModeBtn" class="active"><i class="fas fa-sun"></i></button>
                <button id="nightModeBtn"><i class="fas fa-moon"></i></button>
            </div>
            <div class="audio-controls">
                <button id="playWindBtn"><i class="fas fa-wind"></i> تشغيل الريح</button>
                <button id="playNightBtn"><i class="fas fa-moon"></i> تشغيل الليل</button>
                <button id="stopAllAudioBtn"><i class="fas fa-stop"></i> إيقاف الصوت</button>
            </div>
        </aside>

        <main class="main-content">
            <header>
                <h1>المنزل الآمن</h1>
                <p>مساحتك للتشافي والنمو من صدمات الطفولة</p>
            </header>

            <section id="welcome" class="active">
                <h2>أهلاً بك في منزلك الآمن</h2>
                <p>هنا تبدأ رحلة التعافي من صدمات الطفولة. نحن نؤمن بأن كل شخص يستحق الشفاء والعيش بحرية من آثار الماضي. هذا الدليل ليس بديلاً عن الدعم المهني، ولكنه أداة لمساعدتك على فهم نفسك بشكل أفضل، وتحديد مسار للشفاء يناسبك.</p>
                <p>ابدأ بـ **"اختبار احتياجات التشافي"** لتحديد المهام المناسبة لك.</p>
                <button class="btn btn-secondary" onclick="showSection('quiz')">ابدأ رحلة التشافي</button>
            </section>

            <section id="quiz">
                <h2>اختبار احتياجات التشافي</h2>
                <p>أجب عن الأسئلة التالية بصدق لمساعدتنا في تخصيص المهام العلاجية لك. لا توجد إجابات صحيحة أو خاطئة، وهذا الاختبار للإرشاد فقط.</p>
                <form id="healingQuiz">
                    <div class="quiz-question">
                        <p>1. هل تجد صعوبة في الثقة بالآخرين، حتى المقربين منهم؟</p>
                        <label><input type="radio" name="q1" value="1"> غالبًا ما أجد صعوبة.</label>
                        <label><input type="radio" name="q1" value="0"> أحيانًا أجد صعوبة.</label>
                        <label><input type="radio" name="q1" value="-1"> نادرًا ما أجد صعوبة.</label>
                    </div>
                    <div class="quiz-question">
                        <p>2. هل تشعر أحيانًا أنك تعيش الماضي، أو أن الذكريات السيئة تسيطر عليك فجأة؟</p>
                        <label><input type="radio" name="q2" value="1"> نعم، يحدث كثيرًا.</label>
                        <label><input type="radio" name="q2" value="0"> أحيانًا.</label>
                        <label><input type="radio" name="q2" value="-1"> نادرًا أو لا يحدث أبدًا.</label>
                    </div>
                    <div class="quiz-question">
                        <p>3. كيف تتعامل مع الغضب أو الحزن الشديد؟</p>
                        <label><input type="radio" name="q3" value="1"> غالبًا ما أكبت مشاعري أو أنفجر.</label>
                        <label><input type="radio" name="q3" value="0"> أحاول السيطرة عليها، لكنها صعبة أحيانًا.</label>
                        <label><input type="radio" name="q3" value="-1"> أستطيع التعبير عنها بطرق صحية.</label>
                    </div>
                    <div class="quiz-question">
                        <p>4. هل تشعر بالذنب أو الخجل بشأن أحداث ماضية، حتى لو لم تكن مسؤولاً عنها؟</p>
                        <label><input type="radio" name="q4" value="1"> نعم، غالبًا ما أشعر بذلك.</label>
                        <label><input type="radio" name="q4" value="0"> أحيانًا، لكن أحاول تجاوزها.</label>
                        <label><input type="radio" name="q4" value="-1"> لا أشعر بذلك غالبًا.</label>
                    </div>
                    <div class="quiz-question">
                        <p>5. هل تواجه صعوبة في وضع حدود صحية في علاقاتك؟</p>
                        <label><input type="radio" name="q5" value="1"> نعم، أجد صعوبة كبيرة.</label>
                        <label><input type="radio" name="q5" value="0"> أحيانًا، لكنني أعمل على ذلك.</label>
                        <label><input type="radio" name="q5" value="-1"> أستطيع وضع حدود واضحة.</label>
                    </div>
                    <div class="quiz-question">
                        <p>6. هل تلاحظ أنك تنجذب لأنماط علاقات غير صحية أو مدمرة؟</p>
                        <label><input type="radio" name="q6" value="1"> نعم، يبدو أنني أكرر نفس الأخطاء.</label>
                        <label><input type="radio" name="q6" value="0"> أحيانًا، لكنني أصبح أكثر وعيًا.</label>
                        <label><input type="radio" name="q6" value="-1"> لا أجد صعوبة في اختيار العلاقات الصحية.</label>
                    </div>
                    <div class="quiz-question">
                        <p>7. هل تعاني من مشاكل في النوم (أرق، كوابيس، استيقاظ متكرر)؟</p>
                        <label><input type="radio" name="q7" value="1"> نعم، غالبًا.</label>
                        <label><input type="radio" name="q7" value="0"> أحيانًا.</label>
                        <label><input type="radio" name="q7" value="-1"> نادرًا أو لا أواجه مشاكل في النوم.</label>
                    </div>
                    <div class="quiz-question">
                        <p>8. هل تلجأ إلى آليات تأقلم غير صحية (مثل الإفراط في الأكل، تعاطي المواد، إدمان العمل) للتعامل مع التوتر؟</p>
                        <label><input type="radio" name="q8" value="1"> نعم، هذه عادتي.</label>
                        <label><input type="radio" name="q8" value="0"> أحيانًا، لكنني أحاول التوقف.</label>
                        <label><input type="radio" name="q8" value="-1"> أتعامل مع التوتر بطرق صحية.</label>
                    </div>
                    <div class="quiz-question">
                        <p>9. هل تشعر بانفصال عن مشاعرك أو عن الواقع أحيانًا؟</p>
                        <label><input type="radio" name="q9" value="1"> نعم، أشعر بالخدر العاطفي.</label>
                        <label><input type="radio" name="q9" value="0"> أحيانًا، في المواقف الصعبة.</label>
                        <label><input type="radio" name="q9" value="-1"> نادرًا ما أشعر بذلك.</label>
                    </div>
                    <div class="quiz-question">
                        <p>10. هل تجد صعوبة في الشعور بالأمان أو الاسترخاء في بيئات معينة؟</p>
                        <label><input type="radio" name="q10" value="1"> نعم، أشعر بالتوتر غالبًا.</label>
                        <label><input type="radio" name="q10" value="0"> أحيانًا، في الأماكن غير المألوفة.</label>
                        <label><input type="radio" name="q10" value="-1"> أشعر بالأمان والاسترخاء بسهولة.</label>
                    </div>
                    <div class="quiz-question">
                        <p>11. هل تعاني من مشاكل صحية جسدية مزمنة (مثل الصداع، مشاكل الجهاز الهضمي) بدون سبب عضوي واضح؟</p>
                        <label><input type="radio" name="q11" value="1"> نعم، أعاني منها غالبًا.</label>
                        <label><input type="radio" name="q11" value="0"> أحيانًا.</label>
                        <label><input type="radio" name="q11" value="-1"> نادرًا أو لا أعاني منها.</label>
                    </div>
                    <div class="quiz-question">
                        <p>12. هل تجد صعوبة في التسامح مع نفسك أو مع الآخرين على أخطاء الماضي؟</p>
                        <label><input type="radio" name="q12" value="1"> نعم، أجد صعوبة كبيرة.</label>
                        <label><input type="radio" name="q12" value="0"> أحيانًا، لكنني أحاول.</label>
                        <label><input type="radio" name="q12" value="-1"> أستطيع التسامح بسهولة.</label>
                    </div>
                    <div class="quiz-question">
                <p>13. هل تشعر أحيانًا أنك تستحق ما حدث لك في الماضي؟</p>
                <label><input type="radio" name="q13" value="1"> نعم، هذا الشعور يراودني.</label>
                <label><input type="radio" name="q13" value="0"> أحيانًا، لكنني أعلم أنه غير صحيح.</label>
                <label><input type="radio" name="q13" value="-1"> لا، أعلم أنني لم أكن أستحق ذلك.</label>
            </div>
            <div class="quiz-question">
                <p>14. هل تجد صعوبة في طلب المساعدة أو الدعم عندما تحتاج إليه؟</p>
                <label><input type="radio" name="q14" value="1"> نعم، أجد الأمر محرجًا أو صعبًا.</label>
                <label><input type="radio" name="q14" value="0"> أحيانًا، حسب الموقف.</label>
                <label><input type="radio" name="q14" value="-1"> لا، أستطيع طلب المساعدة بسهولة.</label>
            </div>
            <div class="quiz-question">
                <p>15. هل تشعر أن صدمات الطفولة لا تزال تؤثر بشكل كبير على حياتك اليومية؟</p>
                <label><input type="radio" name="q15" value="1"> نعم، بشكل كبير جدًا.</label>
                <label><input type="radio" name="q15" value="0"> نعم، بشكل متوسط.</label>
                <label><input type="radio" name="q15" value="-1"> لا، تأثيرها محدود أو تلاشى.</label>
            </div>
            <button type="submit" class="btn">احصل على المهام المخصصة</button>
        </form>
    </section>

    <section id="tasks">
        <h2>مهام التشافي المخصصة</h2>
        <p>بناءً على إجاباتك، إليك مجموعة من المهام المقترحة لمساعدتك في رحلة التشافي. تذكر أن هذه المهام هي دليل إرشادي، والالتزام بها سيساهم في تقدمك.</p>
        <div class="tasks-grid" id="assignedTasks">
            </div>
    </section>

    <section id="progress">
        <h2>تتبع التقدم الأسبوعي</h2>
        <p>تابع تقدمك في مهام التشافي. كل مهمة تنجزها تساهم في نقطة تشافي. تذكر أن التشافي عملية مستمرة.</p>
        <div class="progress-container">
            <h3>نقاط التشافي الكلية: <span id="totalHealingPoints">0</span></h3>
            <h3>نسبة التشافي التقديرية: <span id="healingPercentage">0%</span></h3>
            <div class="progress-bar-wrapper">
                <div class="progress-bar" id="healingProgressBar"></div>
            </div>
            <div class="score-info">
                <span>أنجزت <span id="completedTasksCount">0</span> من <span id="totalTasksCount">0</span> مهام.</span>
                <button class="btn btn-secondary" onclick="resetWeeklyProgress()">إعادة تعيين التقدم الأسبوعي</button>
            </div>
        </div>
    </section>

    <section id="journal">
        <h2>مذكرة التدوين</h2>
        <p>هنا يمكنك تدوين أفكارك ومشاعرك وتجاربك. الكتابة تساعد على معالجة المشاعر واكتشاف الذات. سيتم حفظ ما تكتبه تلقائيًا في متصفحك.</p>
        <div class="notebook-container">
            <textarea id="journalEntry" placeholder="ابدأ بالكتابة هنا..."></textarea>
            <button id="saveJournalBtn" class="btn">حفظ المذكرة</button>
            <p style="margin-top: 10px; font-size: 0.9em; color: gray;">*ملاحظة: يتم حفظ المذكرة تلقائيًا في متصفحك. لن تكون متاحة على أجهزة أخرى.*</p>
        </div>
    </section>

    <section id="resources">
        <h2>مصادر الدعم والتعافي</h2>
        <p>لا تتردد في طلب المساعدة. هناك العديد من الموارد المتاحة لمساعدتك في رحلة التعافي.</p>
        <div class="tasks-grid">
            <div class="task-card">
                <h4>العلاج النفسي</h4>
                <p>العلاج السلوكي المعرفي (CBT)، العلاج الجدلي السلوكي (DBT)، وعلاج إزالة حساسية حركة العين وإعادة المعالجة (EMDR) هي بعض الأساليب الفعالة في معالجة صدمات الطفولة.</p>
                <a href="https://www.google.com/search?q=أطباء+نفسيون+متخصصون+في+صدمات+الطفولة" target="_blank" class="btn btn-secondary">ابحث عن معالج</a>
            </div>
            <div class="task-card">
                <h4>مجموعات الدعم</h4>
                <p>الانضمام إلى مجموعات الدعم مع أشخاص يشاركونك تجارب مماثلة يمكن أن يوفر شعورًا بالانتماء والتفهم والدعم المتبادل.</p>
                <a href="https://www.google.com/search?q=مجموعات+دعم+صدمات+الطفولة" target="_blank" class="btn btn-secondary">تعرف على المجموعات</a>
            </div>
            <div class="task-card">
                <h4>كتب وموارد إلكترونية</h4>
                <p>قراءة الكتب والمقالات المتخصصة حول صدمات الطفولة والتعافي منها يمكن أن تزيد من وعيك وتفهمك للموضوع.</p>
                <a href="https://www.google.com/search?q=كتب+عن+علاج+صدمات+الطفولة" target="_blank" class="btn btn-secondary">استكشف الموارد</a>
            </div>
        </div>
    </section>
</main>
</div>

<script>
// --- Global Variables & Initial Setup ---
const sections = document.querySelectorAll('main section');
const navLinks = document.querySelectorAll('.nav-link');
const healingQuizForm = document.getElementById('healingQuiz');
const assignedTasksDiv = document.getElementById('assignedTasks');
const totalHealingPointsSpan = document.getElementById('totalHealingPoints');
const healingPercentageSpan = document.getElementById('healingPercentage');
const healingProgressBar = document.getElementById('healingProgressBar');
const completedTasksCountSpan = document.getElementById('completedTasksCount');
const totalTasksCountSpan = document.getElementById('totalTasksCount');
const journalEntry = document.getElementById('journalEntry');
const saveJournalBtn = document.getElementById('saveJournalBtn');
const dayModeBtn = document.getElementById('dayModeBtn');
const nightModeBtn = document.getElementById('nightModeBtn');
const windSound = document.getElementById('windSound');
const nightSound = document.getElementById('nightSound');
const playWindBtn = document.getElementById('playWindBtn');
const playNightBtn = document.getElementById('playNightBtn');
const stopAllAudioBtn = document.getElementById('stopAllAudioBtn');


let userHealingScore = 0; // Total score from the quiz

// Task definitions for both genders
const tasks = {
    general: [
        { id: 'task1', text: 'مارس التنفس الواعي لمدة 5 دقائق يوميًا.' },
        { id: 'task2', text: 'اكتب في المذكرة عن مشاعرك مرة واحدة على الأقل هذا الأسبوع.' },
        { id: 'task3', text: 'تواصل مع صديق مقرب أو فرد من العائلة واقضِ وقتًا ممتعًا.' },
        { id: 'task4', text: 'خصص 30 دقيقة لنشاط تستمتع به ويجلب لك الهدوء.' },
        { id: 'task5', text: 'تعلم معلومة جديدة عن صدمات الطفولة أو آليات التأقلم الصحية.' },
    ],
    females: [
        { id: 'taskF1', text: 'تدربي على قول "لا" لطلب لا تشعرين بالراحة تجاهه.' },
        { id: 'taskF2', text: 'مارسي التأمل الموجه لتعزيز تقدير الذات.' },
        { id: 'taskF3', text: 'شاركي مشاعر الخجل أو الذنب مع شخص تثقين به أو معالج.' },
        { id: 'taskF4', text: 'دللي نفسك بنشاط بسيط (مثل حمام دافئ، قراءة كتاب، مشاهدة فيلم).' },
        { id: 'taskF5', text: 'ابحثي عن مجموعة دعم نسائية عبر الإنترنت أو في مجتمعك.' },
    ],
    males: [
        { id: 'taskM1', text: 'اسمح لنفسك بالشعور بالحزن أو الغضب دون الحكم عليه.' },
        { id: 'taskM2', text: 'مارس نشاطًا بدنيًا قويًا لتفريغ الطاقة السلبية.' },
        { id: 'taskM3', text: 'تحدث مع مرشد أو ذكر موثوق به عن تحدياتك.' },
        { id: 'taskM4', text: 'حدد هدفًا صغيرًا وحققه لتعزيز إحساسك بالإنجاز والقوة.' },
        { id: 'taskM5', text: 'تحدّى فكرة "الرجل القوي الذي لا يبكي" بداخلك.' },
    ]
};

let currentAssignedTasks = []; // To store tasks assigned to the user
let completedTasks = {}; // To store completion status for each task { taskId: true/false }
let currentWeeklyScore = 0;
const MAX_WEEKLY_SCORE = 100; // Example max score for calculating percentage

// --- Utility Functions ---

// Function to show/hide sections
function showSection(id) {
    sections.forEach(section => {
        section.classList.remove('active');
    });
    document.getElementById(id).classList.add('active');

    navLinks.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href') === '#' + id) {
            link.classList.add('active');
        }
    });
}

// Function to calculate quiz score and assign tasks
healingQuizForm.addEventListener('submit', function(e) {
    e.preventDefault();
    userHealingScore = 0;
    const formData = new FormData(healingQuizForm);
    const answers = {};
    for (let [name, value] of formData.entries()) {
        answers[name] = parseInt(value);
        userHealingScore += parseInt(value);
    }

    console.log("Quiz Score:", userHealingScore); // Debugging

    assignHealingTasks(userHealingScore);
    showSection('tasks'); // Show tasks section after quiz
});

function assignHealingTasks(score) {
    let tasksToAssign = [...tasks.general]; // Start with general tasks

    // Adjust based on score (example logic, refine as needed)
    // Higher positive score means more impact from trauma, need more specialized tasks
    if (score >= 5) { // Significant impact
        // Ask user for gender, this is a simplified example
        // In a real app, you'd have a gender selection in the quiz or profile
        const userGender = prompt("الرجاء إدخال جنسك (ذكر/أنثى) لتخصيص المهام:", "ذكر").trim();
        if (userGender === "أنثى") {
            tasksToAssign = tasksToAssign.concat(tasks.females);
        } else if (userGender === "ذكر") {
            tasksToAssign = tasksToAssign.concat(tasks.males);
        } else {
            alert("لم يتم تحديد الجنس، سيتم عرض المهام العامة فقط.");
        }
    } else if (score > -5 && score < 5) { // Moderate impact
        tasksToAssign = tasksToAssign.concat(tasks.general.slice(0, 3)); // Add few general tasks
    }
    // If score is very low (less impact), maybe just offer general awareness.

    currentAssignedTasks = tasksToAssign;
    totalTasksCountSpan.textContent = currentAssignedTasks.length; // Update total tasks count
    renderTasks();
    saveTasksToLocalStorage();
}

function renderTasks() {
    assignedTasksDiv.innerHTML = ''; // Clear previous tasks
    currentAssignedTasks.forEach(task => {
        const isCompleted = completedTasks[task.id] || false;
        const taskCard = document.createElement('div');
        taskCard.classList.add('task-card');
        if (isCompleted) {
            taskCard.classList.add('completed');
        }
        taskCard.innerHTML = `
            <h4>${task.text}</h4>
            <p>أنجز هذه المهمة لتسجيل نقطة تشافي.</p>
            <div class="task-completion">
                <span>أنجزت؟</span>
                <input type="checkbox" data-task-id="${task.id}" ${isCompleted ? 'checked' : ''}>
            </div>
        `;
        assignedTasksDiv.appendChild(taskCard);
    });
    addCheckboxListeners();
    updateProgressDisplay(); // Update progress after rendering tasks
}

function addCheckboxListeners() {
    document.querySelectorAll('.task-completion input[type="checkbox"]').forEach(checkbox => {
        checkbox.removeEventListener('change', handleTaskCompletion); // Prevent duplicate listeners
        checkbox.addEventListener('change', handleTaskCompletion);
    });
}

function handleTaskCompletion(event) {
    const taskId = event.target.dataset.taskId;
    const isChecked = event.target.checked;
    completedTasks[taskId] = isChecked;

    const taskCard = event.target.closest('.task-card');
    if (isChecked) {
        taskCard.classList.add('completed');
    } else {
        taskCard.classList.remove('completed');
    }
    updateProgressDisplay();
    saveTasksToLocalStorage();
}

function updateProgressDisplay() {
    let completedCount = 0;
    currentAssignedTasks.forEach(task => {
        if (completedTasks[task.id]) {
            completedCount++;
        }
    });
    currentWeeklyScore = completedCount * (MAX_WEEKLY_SCORE / currentAssignedTasks.length || 0);
    if (currentAssignedTasks.length === 0) { // Handle division by zero if no tasks
        currentWeeklyScore = 0;
    }

    totalHealingPointsSpan.textContent = completedCount;
    healingPercentageSpan.textContent = `${Math.round(currentWeeklyScore)}%`;
    healingProgressBar.style.width = `${Math.round(currentWeeklyScore)}%`;
    completedTasksCountSpan.textContent = completedCount;
}

function resetWeeklyProgress() {
    if (confirm("هل أنت متأكد أنك تريد إعادة تعيين تقدم المهام الأسبوعي؟")) {
        completedTasks = {};
        currentWeeklyScore = 0;
        saveTasksToLocalStorage();
        renderTasks(); // Re-render tasks to reflect reset
        alert("تم إعادة تعيين تقدم المهام الأسبوعي.");
    }
}

// --- Local Storage Management ---
function saveTasksToLocalStorage() {
    localStorage.setItem('assignedTasks', JSON.stringify(currentAssignedTasks));
    localStorage.setItem('completedTasks', JSON.stringify(completedTasks));
}

function loadTasksFromLocalStorage() {
    const savedAssignedTasks = localStorage.getItem('assignedTasks');
    const savedCompletedTasks = localStorage.getItem('completedTasks');

    if (savedAssignedTasks) {
        currentAssignedTasks = JSON.parse(savedAssignedTasks);
    } else {
        // If no tasks saved, assign general tasks by default
        currentAssignedTasks = [...tasks.general];
    }

    if (savedCompletedTasks) {
        completedTasks = JSON.parse(savedCompletedTasks);
    }
    totalTasksCountSpan.textContent = currentAssignedTasks.length; // Update total tasks count on load
}

// --- Journal Functionality ---
function loadJournalEntry() {
    const savedEntry = localStorage.getItem('journalEntry');
    if (savedEntry) {
        journalEntry.value = savedEntry;
    }
}

function saveJournalEntry() {
    localStorage.setItem('journalEntry', journalEntry.value);
    alert('تم حفظ المذكرة بنجاح!');
}

journalEntry.addEventListener('input', () => {
         // Optional: Auto-save on input with a debounce
         // This prevents saving too frequently while typing.
         clearTimeout(journalEntry.timeout);
         journalEntry.timeout = setTimeout(() => {
             localStorage.setItem('journalEntry', journalEntry.value);
             console.log("Journal auto-saved!");
         }, 1000); // Save after 1 second of no typing
});
saveJournalBtn.addEventListener('click', saveJournalEntry);


// --- Day/Night Mode & Sound ---
function stopAllAudio() {
    windSound.pause();
    windSound.currentTime = 0; // Reset to start
    nightSound.pause();
    nightSound.currentTime = 0; // Reset to start
    // Remove active class from audio buttons if any
    playWindBtn.classList.remove('active');
    playNightBtn.classList.remove('active');
}

function setLightMode() {
    document.body.classList.remove('dark-mode');
    dayModeBtn.classList.add('active');
    nightModeBtn.classList.remove('active');
    localStorage.setItem('theme', 'light');
    // When changing mode, stop current sounds and try to play wind
    stopAllAudio();
    playWindBtn.click(); // Simulate click to trigger play
}

function setDarkMode() {
    document.body.classList.add('dark-mode');
    nightModeBtn.classList.add('active');
    dayModeBtn.classList.remove('active');
    localStorage.setItem('theme', 'dark');
    // When changing mode, stop current sounds and try to play night
    stopAllAudio();
    playNightBtn.click(); // Simulate click to trigger play
}

dayModeBtn.addEventListener('click', setLightMode);
nightModeBtn.addEventListener('click', setDarkMode);

playWindBtn.addEventListener('click', () => {
    stopAllAudio(); // Stop other sounds first
    windSound.play().then(() => {
        playWindBtn.classList.add('active');
    }).catch(e => {
        console.log("Wind sound play failed:", e);
        alert("تعذر تشغيل صوت الريح. قد تحتاج إلى التفاعل مع الصفحة أولاً أو قد تكون هناك مشكلة في رابط الصوت.");
    });
});

playNightBtn.addEventListener('click', () => {
    stopAllAudio(); // Stop other sounds first
    nightSound.play().then(() => {
        playNightBtn.classList.add('active');
    }).catch(e => {
        console.log("Night sound play failed:", e);
        alert("تعذر تشغيل صوت الليل. قد تحتاج إلى التفاعل مع الصفحة أولاً أو قد تكون هناك مشكلة في رابط الصوت.");
    });
});

stopAllAudioBtn.addEventListener('click', stopAllAudio);


// Initialize theme and sound on page load
function initializeTheme() {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
        document.body.classList.add('dark-mode');
        nightModeBtn.classList.add('active');
        dayModeBtn.classList.remove('active');
    } else {
        document.body.classList.remove('dark-mode');
        dayModeBtn.classList.add('active');
        nightModeBtn.classList.remove('active');
    }
    // Do NOT attempt to play audio here directly on load, as it will likely be blocked.
    // Rely on user interaction (mode change or explicit play buttons).
}

// --- Initial Load & Event Listeners ---
document.addEventListener('DOMContentLoaded', () => {
    initializeTheme();
    loadTasksFromLocalStorage();
    renderTasks();
    loadJournalEntry();

    // Setup navigation links
    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            showSection(targetId);
        });
    });

    // Show welcome section by default
    showSection('welcome');
});
</script>

</body>
</html>
